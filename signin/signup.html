<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In | William Port</title>
    <style>
        .hide {
            display: none;
        }
        .pwderror {
            justify-self: center;
            align-self: center;
            display: flex;
            color: rgb(255, 0, 0);
        }
        body {
            justify-content: center;
            display: flex;
        }
        .form {
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 350px;
        background-color: #fff;
        padding: 20px;
        border-radius: 20px;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        justify-items: center;
        }

        .title {
        font-size: 28px;
        color: royalblue;
        font-weight: 600;
        letter-spacing: -1px;
        position: relative;
        display: flex;
        align-items: center;
        padding-left: 30px;
        }

        .title::before,.title::after {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        border-radius: 50%;
        left: 0px;
        background-color: royalblue;
        }

        .title::before {
        width: 18px;
        height: 18px;
        background-color: royalblue;
        }

        .title::after {
        width: 18px;
        height: 18px;
        animation: pulse 1s linear infinite;
        }

        .message, .signin {
        color: rgba(88, 87, 87, 0.822);
        font-size: 14px;
        }

        .signin {
        text-align: center;
        }

        .signin a {
        color: royalblue;
        }

        .signin a:hover {
        text-decoration: underline royalblue;
        }

        .flex {
        display: flex;
        width: 100%;
        gap: 10%;
        }

        .form label {
        position: relative;
        }

        .form label .input {
        width: 100%;
        padding: 10px 10px 20px 10px;
        outline: 0;
        border: 1px solid rgba(105, 105, 105, 0.397);
        border-radius: 10px;
        }

        .form label .input + span {
        position: absolute;
        left: 10px;
        top: 15px;
        color: grey;
        font-size: 0.9em;
        cursor: text;
        transition: 0.3s ease;
        }

        .form label .input:placeholder-shown + span {
        top: 15px;
        font-size: 0.9em;
        }

        .form label .input:focus + span,.form label .input:valid + span {
        top: 30px;
        font-size: 0.7em;
        font-weight: 600;
        }

        .form label .input:valid + span {
        color: green;
        }

        .submit {
        border: none;
        outline: none;
        background-color: royalblue;
        padding: 10px;
        border-radius: 10px;
        color: #fff;
        font-size: 16px;
        transform: .3s ease;
        }

        .submit:hover {
        background-color: rgb(56, 90, 194);
        }

        @keyframes pulse {
        from {
            transform: scale(0.9);
            opacity: 1;
        }

        to {
            transform: scale(1.8);
            opacity: 0;
        }
        }
    </style>
</head>
<body>
    <!-- From Uiverse.io by Yaya12085 -->
    <form class="form" id="signupForm">
        <p class="title">Register </p>
        <p class="message">Signup now and get full access to our app. </p>

        <label>
            <input required="" placeholder="" type="text" class="input" id="username", name="username">
            <span>Username</span>
        </label>
    
        <label>
            <input required="" placeholder="" type="email" class="input" id="email", name="email">
            <span>Email</span>
        </label>
    
        <label>
            <input required="" placeholder="" type="password" class="input" id="password", name="password">
            <span>Password</span>
        </label>
        <label>
            <input required="" placeholder="" type="password" class="input" id="confirmpassword", name="confirmpassword">
            <span>Confirm password</span>
        </label>

        <div id="pwderror-wrapper" class="hide">
        <label id="pwderror" class="hide pwderror">Passwords do not match!</label>
        </div>

        <button class="submit">Submit</button>
        <p class="signin">Already have an account? <a href="http://192.168.1.80:8080/signin">Signin</a> </p>
    </form>

    <script>
        document.getElementById('signupForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmpassword').value;

            if (password !== confirmPassword) {
                document.getElementById('pwderror').classList.remove('hide');
                document.getElementById('pwderror-wrapper').classList.remove('hide');
                return;
            }

            const formData = new FormData(this);
            const urlParams = window.location.search;
            const urlParamsList = urlParams.substring(1).split('&');
            const params = new URLSearchParams();

            function encode(str) {
                str = str.replace('/', '%2F');
                str = str.replace('?', '%3F');
                str = str.replace('&', '%26');
                str = str.replace('=', '%3D');
                str = str.replace('+', '%2B');
                return str;
            }

            for (const [key, value] of formData.entries()) {
                if (key !== 'confirmpassword') {
                    let encodedValue = encode(value);
                    params.append(key, encodedValue);
                }
            }

            for (const param of urlParamsList) {
                const [key, value] = param.split('=');
                params.append(key, value);
            }

            fetch('http://192.168.1.80:8080/api/signup?' + params.toString(), {
                method: 'POST'
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Network response was not ok.');
            })
            .then(data => {
                console.log("Success: " + data);
            })
            .catch(error => {
                console.error('Error: ', error);
            });
            window.location.href = 'http://192.168.1.80:8080/signin';
        });
    </script>
</body>
</html>